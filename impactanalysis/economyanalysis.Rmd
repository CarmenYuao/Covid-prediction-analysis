---
title: "economyanalysis"
output: html_document
date: '2022-04-09'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

load related packages
```{r}
library(TSA)
library(urca)
library(tseries)
```

# Unemployment
we discuss about a complex situation - the Unemployment Rate
The Question is: What influence does COVID have on unemployment?
The **central** problem is when does the intervention happen and what is its effect? The intervention is a **gradual**, **delayed** process here, affected by many factors. 


## Data Selection
we refer data from: OECD (2022), Unemployment rate (indicator). doi: 10.1787/52570002-en (Accessed on 09 April 2022)
Due to the guarantee of OECD, the data is highly believable and objective. 
Granularity : the finest granularity for OECD data is by month, therefore we use it.

Intervention Date: There are many factors caused by COVID which can increase the unemployment rate. Supply chain, mental health. However, we use SAH policy as indicator. Because many job have to be in site or interact with people in site. The SAH policy has worked in the middle of March. Since reasonable delay, we use the April 2020 as the exact intervention date.

The Starting Date & Ending Date is not very important.

## Basic Data Analysis
load the data and convert it to time series
```{r}
ue <- read.csv(file="../data/impact/unemploymentSwiss.csv")
head(ue)
ue.ts <- ts(ue$Value)
ue.len <- dim(ue)[1]
intervention <- which(ue$TIME == "2020-04")
```

plot the data
```{r}
plot(ue.ts ,type="l",col="blue", xlab="Month", ylab="unemployment rate", main="OECD HUR(Swiss)",xaxt="n")
axis(1, at=seq(1, ue.len),labels=ue$TIME, cex.axis = 0.6, las="2")
abline(v=intervention,col="grey",lty="dashed", lwd=2)
abline(v=intervention-1,col="grey",lty="dashed", lwd=2)
```
plot the data after log-transform
```{r}
plot(log(ue.ts) ,type="l",col="blue", xlab="Month", ylab="log unemployment rate", main="OECD HUR(Swiss)",xaxt="n")
axis(1, at=seq(1, ue.len),labels=ue$TIME, cex.axis = 0.6, las="2")
abline(v=intervention,col="grey",lty="dashed", lwd=2)
abline(v=intervention-1,col="grey",lty="dashed", lwd=2)
```
The log transformation doesn't play an important role here. Because the scale for these data is close.

test stability for the whole time series
```{r}
adf.test(ue.ts)
# adf.test(log(ue.ts))
summary(ur.kpss(ue.ts))
# summary(ur.kpss(log(ue.ts)))
```
The data have unit-root but pass the KPSS test, we examine its difference.
```{r}
adf.test(diff(ue.ts))
summary(ur.kpss(diff(ue.ts)))
Box.test(diff(ue.ts),lag=5)
```
show the residuals and autocorrelation directly.
```{r}
plot(diff(ue.ts),ylab="difference")
acf(diff(ue.ts))
pacf(diff(ue.ts))
```
After difference, the time series is stable. To our surprise, it even pass the white noise test! 
But can we believe this result? No, because we might over-estimate the variance 

## Model Building
set up the intervention effect
```{r}
step <- rep(0,ue.len)
step[intervention:ue.len] <- 1
pulse <- rep(0,ue.len)
pulse[intervention] <- 1
ramp <- rep(0, ue.len)
ramp[intervention:ue.len] <- (intervention:ue.len) - (intervention-1)
time <- 1:ue.len
```

### Difference First
according to the previous result, the pure difference will perform well. We try to improve it in this subsection.
```{r}
m.basic <- arimax(diff(ue.ts), order=c(0,0,0))
m.basic
Box.test(resid(m.basic))
```


```{r}
m.diff <- arimax(ue.ts, order=c(2,1,0), xreg = data.frame(step))
m.diff
```

```{r}
acf(resid(m.diff), main="")
pacf(resid(m.diff), main="")
```
evaluation
```{r}
plot(resid(m.diff))
Box.test(resid(m.diff), type = "Ljung-Box", lag = 20)
```
Therefore the Current Difference model is available for our data.
After tuning parameter, seasonality won't work here. The coefficient is not significant and the AIC will increase.

### Pure Intervention Model.
```{r}
m.itv <- arimax(ue.ts, order=c(1,0,0),seasonal = list(order=c(0,0,1), period=5), xreg = data.frame(step,time,ramp))
m.itv
```
This model is generated by tuning. The AIC is the smallest by tuning and all coefficient is significant. It is difficult to understand.
There is a strong correlation for lag 5 and lag 9 without current seasonal term, which causes the Box test to refuse hypothesis.

```{r}
acf(resid(m.itv))
pacf(resid(m.itv))
```
evaluation
```{r}
plot(resid(m.itv))
Box.test(resid(m.itv), type = "Ljung-Box", lag = 20)
```
```



